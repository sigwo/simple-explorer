<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <title>Jupiter Explorer!</title>
  <script src="https://code.jquery.com/jquery-1.10.2.js"></script>

  <style>
    * {box-sizing: border-box;}

    body {
      margin: 0;
      font-family: Arial, Helvetica, sans-serif;
      background-color: #e8d7cf;
      color: #5b3737;
    }

    a:link {
      color: #d36738;
    }

    a.visited {
      color: #5b3737;
    }

    a.hover {
      color: #f2a26c;
    }

    .topnav {
      overflow: hidden;
      background-color: #d36738;
    }

    .explorer {
      -webkit-column-count: 1; /* Chrome, Safari, Opera */
      -moz-column-count: 1; /* Firefox */
      column-count: 1;
      -webkit-column-rule-style: solid; /* Chrome, Safari, Opera */
      -moz-column-rule-style: solid; /* Firefox */
      column-rule-style: solid;
      border-top-style: solid;
      border-color: #5b3737;
      border-width: 1px;
    }

    .flex-container {
      display: flex;
      margin: 5px 0px 0px 20px;
      background-color: #e8d7cf;
    }

    .flex-container > div {
      background-color: #f2a26c;
      margin: 0px 0px 0px 20px;
      padding: 10px;
      font-size: 16px;
      border-style: solid;
      border-color: #5b3737;
      border-width: 1px;
      border-radius: 5px;
    }

    .topnav a {
      float: left;
      display: block;
      color: #5b3737;
      text-align: center;
      padding: 14px 16px;
      text-decoration: none;
      font-size: 17px;
    }

    .topnav a:hover {
      background-color: #f2a26c;
      color: #e8d7cf;
    }

    .topnav a.visited {
      background-color: #f2a26c;
      color: #5b3737;
    }

    .topnav .search-container {
      float: right;
    }

    .topnav input[type=text] {
      padding: 6px;
      margin-top: 8px;
      font-size: 17px;
      border: none;
    }

    .topnav .search-container button {
      float: right;
      padding: 6px 10px;
      margin-top: 8px;
      margin-right: 16px;
      background: #ddd;
      font-size: 17px;
      border: none;
      cursor: pointer;
    }

    .topnav .search-container button:hover {
      background: #ccc;
    }

    @media screen and (max-width: 600px) {
      .topnav .search-container {
        float: none;
      }
      .topnav a, .topnav input[type=text], .topnav .search-container button {
        float: none;
        display: block;
        text-align: left;
        width: 100%;
        margin: 0;
        padding: 14px;
      }
      .topnav input[type=text] {
        border: 1px solid #ccc;  
      }
    }

    pre {
      font-family: "courier new", courier, monospace;
      font-size: 16px;
    }
  </style>
</head>
<script>
  //////////
  // Main explorer function, displays last blocks for easy viewing
  //////////
  var apiServer = 'https://status.gojupiter.tech'
  var url = apiServer + "/nxt?=%2Fnxt&requestType=getBlocks&lastIndex=60"
  var blockUrl = apiServer + "/nxt?=%2Fnxt&requestType=getBlock&height="
  $.getJSON(url, function(data) {
    var numbers = [];
    var genesisDate = new Date("10/21/2017 18:19:28");
    var genesisEpoch = genesisDate.getTime()/1000.0; 
    $.each(data.blocks, function(key, block) {
      var blockEpoch = genesisEpoch+block.timestamp;
      var blockDate = new Date(blockEpoch*1000);
      numbers.push(blockDate.toUTCString() + " &emsp;&emsp; <a href=" + blockUrl+block.height +
        "&includeTransactions=true&includeExecutedPhased=true>" + block.height + "</a> &emsp;&emsp; " + block.numberOfTransactions + " &emsp;&emsp; " +
        block.block + "</br>");
    });
    
    $("<ul/>",                                                                                                                                                                                                         {
      "class": "",
      html: numbers.join("")
    }).appendTo("body");
  });

  //////////
  // Gets unconfirmed Transaction count
  //////////
  var url = apiServer + "/nxt?=%2Fnxt&requestType=getUnconfirmedTransactions"
  $.getJSON(url, function(data) {
    document.getElementById("unconfirmedTxs").innerText= data.unconfirmedTransactions.length;
  });

  //////////
  // Gets last 100 blocks transaction count
  //////////
  var url = apiServer + "/nxt?=%2Fnxt&requestType=getBlocks&lastIndex=100";
  $.getJSON(url, function(data) {
    var txs = 0;
    var dailyTxs = 0;
      $.each(data.blocks, function(key, block) {
        dailyTxs += txs + block.numberOfTransactions;
      });
      document.getElementById("dailyTxs").innerText= dailyTxs; 
  });

  //////////
  // Used to return searched blocks in raw JSON format
  //////////
  function searchBlocks() {
    var apiServer = 'https://status.gojupiter.tech'
    var search = $("#blocksearch").val();
    var blocks = apiServer + "/nxt?=%2Fnxt&requestType=getBlock&height=" + search;
    var tx = apiServer + "/nxt?=%2Fnxt&requestType=getTransaction&transaction=" + search;
    var account = apiServer + "/nxt?=%2Fnxt&requestType=getAccount&account=" + search;
    $.getJSON(blocks, function(data) {
      if(data.height == search ) {
        var doneJSON = JSON.stringify(data, null, 4);
        document.getElementById("block").innerText = doneJSON;
      } else {
        $.getJSON(tx, function(data) {
          if(data.transaction == search) {
            var doneJSON = JSON.stringify(data, null, 4);
            document.getElementById("block").innerText = doneJSON;
      } else {
        $.getJSON(account, function(data) {
          if(data.accountRS || data.account == search) {
            var doneJSON = JSON.stringify(data, null, 4);
            document.getElementById("block").innerText = doneJSON;
          } else {
            document.getElementById("block").innerText = "Your search is empty. Try again.";
          }
        });
      }
    });
    };
  });
  };
</script>

<body>
    <div style="font-weight: bold;" class="topnav">
        <a class="active" href="https://gojupiter.tech">Jupiter</a>
        <a href="https://metis.sigwo.tech/">Metis</a>
        <div class="search-container">
            <button onClick="window.location.reload();"><i class="fa fa-refresh"></i></button>
            <input type="text" placeholder="Search block/tx/account..." id="blocksearch">
            <button onClick="searchBlocks();"><i class="fa fa-search"></i></button>
        </div>
      </div>
  <div>
  <table>
    <div class="explorer">
        <div class="flex-container"><pre id="block"></pre></div>
      <div class="flex-container"> 
          <div>Recent Transactions (last 100 blocks) <span style="font-weight: bold;" id="dailyTxs">&emsp;&emsp;</span></div>
          <div>Unconfirmed Transactions <span  style="font-weight: bold;" id="unconfirmedTxs"></span>&emsp;</div>
      </div>
      </div>
      
    <thead>
      <th width="300">Timestamp</th>
      <th width="75">Height</th>
      <th width="80">Txs</th>
      <th width="160">Hash</th>
    </thead>
  </div>
  </table>
</div>
</body>
</html>
